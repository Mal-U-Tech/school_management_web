<!-- we will be using this to display the list of students -->

<ng-container *ngIf="students$ | async as students">
  <app-content>
    <div class="tw-flex tw-justify-between tw-items-center">
      <div class="tw-flex tw-flex-col tw-items-start">
        <h1 class="title">Students</h1>

        <p>
        {{ students.count }} student<ng-container
          *ngIf="students.count > 1 || students.count < 1">s</ng-container>
        </p>
      </div>

      <div class="tw-flex tw-justify-between">
        <div [formGroup]="form" class="search">
          <mat-form-field appearance="outline">
            <mat-icon matIconSuffix color="primary">search</mat-icon>

            <mat-label color="primary">Search</mat-label>
            <input matInput placeholder="Search for students" formControlName="search" type="text" />

            <mat-hint>Search for students by name, email, or mobile number</mat-hint>
          </mat-form-field>
        </div>
      </div>
    </div>

    <!-- display list of students -->
    <div class="tw-mt-6">
      <table mat-table [dataSource]="students.data">
        <ng-container matColumnDef="avatar">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let student">
            <div matRipple class="avatar">
              <img *ngIf="student.user?.avatar" [src]="student.user?.avatar" />
              <mat-icon *ngIf="!student.user?.avatar">account_circle</mat-icon>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Full Name</th>
          <td mat-cell *matCellDef="let student" class="tw-capitalize">
            {{ student.user?.firstname?.toLowerCase() ?? '' }}
            {{ student.user?.lastname?.toLowerCase() ?? '' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="contact">
          <th mat-header-cell *matHeaderCellDef>Contact Information</th>
          <td mat-cell *matCellDef="let student">
            <a [href]="'mailto:' + student.user?.email">{{ student.user?.email }}</a>
            <ng-container *ngIf="student.user?.mobile">/{{ student.user?.mobile }}</ng-container>
          </td>
        </ng-container>

        <tr *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="columns.length" *ngIf="(api$ | async) as api">
            <div class="tw-flex tw-flex-col tw-items-center tw-mt-4 nosubjects" *ngIf="!api.loading">
              <p>
              {{ (school$ | async)?.name }} has no students associated.
              @if ((add_student_permission$ | async) === false) {
              You do not have permission to add new students.
              }
              </p>
              @if (add_student_permission$ | async) {
              <button mat-stroked-button color="primary" (click)="addstudents()">Add Students</button>
              }
            </div>

            <app-loader class="loader" *ngIf="api.loading"></app-loader>
          </td>
        </tr>

        <tr mat-header-row *matHeaderRowDef="columns"></tr>
        <tr mat-row *matRowDef="let row; columns: columns"></tr>
      </table>

      <mat-paginator
        showFirstLastButtons
        [length]="students.count"
        [pageSizeOptions]="[5, 10, 20, 50, 100]"
        [pageSize]="10"
        ></mat-paginator>

    </div>
  </app-content>
</ng-container>

<ng-container *ngIf="search$ | async"></ng-container>
